<!-- https://bulma.io/documentation/form/general/#complete-form-example -->
<!-- <script src="https://kit.fontawesome.com/f48c21cdaf.js" crossorigin="anonymous"></script> 导入icon -->
<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Hello Bulma!</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css">
    <script src="https://kit.fontawesome.com/f48c21cdaf.js" crossorigin="anonymous"></script>
</head>

<body>
    <section class="section">
        <div class="container">
            <h1 class="title">
                Hello World
            </h1>
            <p class="subtitle">
                My first website with <strong>Bulma</strong>!
            </p>
            <div class="columns">
                <!-- 将表单数据提交到目标主机的form目录下 -->
                <!-- 表单提交时onsubmit方法会执行，return false取消默认表单提交方式 -->
                <form class="column is-one-third" action="/bookings" method="POST"
                    onsubmit="postData(this);return false">
                    <!-- 创建一个表单，一个占三分之一列空间， action将表单数据提交给链接 -->
                    <!-- method设置提交数据方式，get直接把参数附在URL里面，post把参数放在请求报文中 -->
                    <!-- input fields通过name属性识别元素，name在input中设置 -->

                    <div class="field">
                        <!-- field 容器保持表单元素间隔一致，一般包含label，control，help（可选） -->
                        <label class="label">Name</label>
                        <div class="control">
                            <!-- 使用control对表单元素进行包装，只能对input，select，button，icon使用 -->
                            <!--
                                control的作用： 
                                keep the spacing consistent
                                combine form controls into a group
                                combine form controls into a list
                                append and prepend icons to a form control
                            -->
                            <input class="input" type="text" placeholder="Text input" name="name" required>
                            <!-- 输入文本框，预置值text input, required设置该项目必填 -->
                        </div>
                    </div>

                    <div class="field">
                        <label class="label">Number of Tickets</label>
                        <div class="control has-icons-left has-icons-right">
                            <input class="input is-success" type="number" placeholder="choose the number" min="1"
                                max="4" name="number_of_tickets">
                            <!-- 只能接受数字，设置数字上下限 -->
                            <span class="icon is-small is-left">
                                <i class="fas fa-user"></i>
                            </span>
                            <span class="icon is-small is-right">
                                <i class="fas fa-check"></i>
                            </span>
                        </div>
                        <p class="help is-success">This username is available</p>
                    </div>

                    <div class="field">
                        <label class="label">Email</label>
                        <div class="control has-icons-left has-icons-right">
                            <input class="input is-danger" type="email" placeholder="Email input" value="hello@"
                                name="email">
                            <span class="icon is-small is-left">
                                <i class="fas fa-envelope"></i>
                            </span>
                            <span class="icon is-small is-right">
                                <i class="fas fa-exclamation-triangle"></i>
                            </span>
                        </div>
                        <p class="help is-danger">This email is invalid</p>
                    </div>

                    <div class="field">
                        <!-- 
                                包含icon表单常见格式：
                                <块 class=control icon位置>
                                    <表单标签></>
                                    <span class=icon 位置 is-small>
                                        <i class=fas fa-哪个icon></i>
                                    </span>
                                    <span>
                                        <i></i>
                                    </span>
                                </块>
                             -->
                        <p class="control has-icons-left has-icons-right">
                            <!-- 需要使用icon的时候在control处需先声明icon位置 -->
                            <input class="input" type="email" placeholder="Email">
                            <!-- placeholder输入提示 -->
                            <span class="icon is-small is-left">
                                <!-- 声明icon类，icon位置和大小，如果文本框不够大，icon不能继续变大 -->
                                <i class="fas fa-envelope"></i>
                                <!-- 获取icon -->
                            </span>
                            <span class="icon is-small is-right">
                                <i class="fas fa-check"></i>
                            </span>
                        </p>
                    </div>

                    <div class="field">
                        <label class="label">Team</label>
                        <div class="control">
                            <div class="select">
                                <select onchange="teamSelected(this.value)" name="team">
                                    <!-- 当选择值改变的时候onchange中的方法会执行 -->
                                    <option value="">Select your favourite team here.</option>
                                    <option value="Avengers">Avengers</option>
                                    <option value="JLA">Justice League</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="field">
                        <label class="label">Superhero</label>
                        <div class="control">
                            <div class="select">
                                <select id="superhero" disabled name="superhero">
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="field">
                        <label class="label">Message</label>
                        <div class="control">
                            <textarea class="textarea" placeholder="Textarea" rows="2" name="message"></textarea>
                            <!-- rows/cols设置文本框的行数/列数,或height/width -->
                        </div>
                    </div>

                    <div class="field">
                        <div class="control">
                            <label class="checkbox">
                                <!--  checkbox 有checked属性则默认选中 -->
                                <input type="checkbox">
                                I agree to the <a href="#">terms and conditions</a>
                            </label>
                        </div>
                    </div>

                    <div class="field">
                        <div class="control">
                            <label class="radio">
                                <input type="radio" name="payment" value="pay by credit card">
                                Pay by Credit Card
                            </label>
                            <label class="radio">
                                <input type="radio" name="payment" value="pay by paypal">
                                Pay by Paypal
                            </label>
                        </div>
                    </div>

                    <div class="field is-grouped">
                        <div class="control">
                            <button type="submit" class="button is-link">Submit</button>
                            <!-- type 设置按钮的功能类型 -->
                        </div>
                        <div class="control">
                            <button type="reset" class="button is-link is-light">Cancel</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </section>
    <script>
        var avengers = ["Captain America", "Iron Man", "Thor", "Hulk", "Black Widow", "Hawkeye"];
        var jla = ["Superman", "Batman", "Wonder Woman", "Flash", "Green Lantern", "Aquaman"];

        function teamSelected(team) {
            //alert(team);
            //alert 设置提示弹窗

            var superheroElem = document.getElementById("superhero");
            superheroElem.options.length = 0;
            //清除原有选项

            if (team == "Avengers") {
                //创建下拉选项
                avengers.forEach(function (item) {
                    var option = document.createElement("option");
                    option.text = item;
                    option.value = item;
                    superheroElem.add(option);
                });

                superheroElem.disabled = false;
                //启用下拉列表

            } else if (team == "JLA") {

                jla.forEach(function (item) {
                    var option = document.createElement("option");
                    option.text = item;
                    option.value = item;
                    superheroElem.add(option);
                });

                superheroElem.disabled = false;

            } else {

                superheroElem.disabled = true;
            }
        }
    </script>

    <script>
        //方法的参数elem即form表单，包括表单结构和里面得到数据
        //async声明这是一个异步方法
        async function postData(elem) {
            //fetch方法通过elem.action获得form表单的数据提交地址，将访问请求提交到这个地址
            //fetch后面{}内的参数表示访问后台的访问方式和访问报文的头部、body内容
            //await声明表示必须要等待fetch方法执行完毕，才能执行接下来的语句
            var response = await fetch(elem.action, {
                //elem.methodd获得form表单的method即数据传送方式
                method: elem.method,
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                //表示将form表单里面填写的内容塞到body里面，和报文一起传给后台
                body: new URLSearchParams(new FormData(elem))
            });

            //在客户端控制台展示
            console.log(response);

            //response是fetch获得的后台传回来的响应结果，里面的ok属性如果是true表示访问程序运行正常，false则表示发生错误
            if (response.ok) {
                //response.json（）将后台回传的数据从json格式转为正常格式，这样里面的数据就可以使用了
                var data = await response.json();
                //JSON.stringify(data)表示把里面的数据data转成字符串
                alert(JSON.stringify(data));
            } else {
                //status表示状态码，如404表示找不到页面，statusCode表示该错误的具体内容
                alert(response.status + " " + response.statusCode);
            }
        }
    </script>
</body>

</html>